# Project Masquerade Ark - 项目总结

## 项目概述
**Project Masquerade Ark** 是一个基于LLM驱动的叙事型生存/推理悬疑游戏原型。游戏设定为暴雪山庄模式的丧尸末日背景，采用文字形式实现核心玩法的最小可行产品（MVP）。

## 技术栈
- **引擎**: Godot 4.x (.NET / C#)
- **数据层**: Godot Resource 系统
- **逻辑层**: 纯 C#（与 UI 解耦）
- **叙事层**: LLM 作为 Game Master (预定义模板实现)
- **UI层**: Godot Scene + Control 节点

## 已实现功能

### 🎯 核心数据结构
- **[`Survivor`](src/Core/Survivor.cs)**: 幸存者NPC类，包含生存属性、精神属性、秘密和关系网
- **[`GameState`](src/Core/GameState.cs)**: 游戏世界状态管理，包含天数、物资、防御值和幸存者列表
- **[`GameEvent`](src/Core/GameEvent.cs)**: 游戏事件数据结构，支持多种事件类型

### ⚙️ 核心系统
- **[`SimulationEngine`](src/Engine/SimulationEngine.cs)**: 游戏逻辑与数值计算引擎
  - 物资消耗与分配系统
  - 幸存者状态更新（饥饿、压力、感染等）
  - Masquerade机制（偷窃、感染检测等秘密事件）
  - **✨ 随机事件系统**（基于压力、物资状况触发）
  - 随机秘密分配系统

- **[`NarrativeEngine`](src/Engine/NarrativeEngine.cs)**: 叙事文本生成系统
  - 将数值事件转换为情感化文本
  - 支持多种事件类型的叙事模板
  - 生成玩家选择分支

### ⏰ 时间机制
- **自动计时器系统**: 可切换手动/自动模式
- **时间推进**: 支持手动点击或自动（10秒一天）
- **自动模式按钮**: 方便的自动/手动切换

### 🎮 游戏管理
- **[`GameManager`](src/Manager/GameManager.cs)**: 协调所有系统的核心管理器
  - 游戏流程控制（初始化 → 模拟 → 叙事 → UI更新）
  - 信号系统解耦各模块通信
  - 投票驱逐功能
  - 调试命令系统
  - 游戏结束条件检测

### 🖥️ 用户界面
- **[`UIManager`](src/UI/UIManager.cs)**: UI显示与交互管理
  - **改进的布局设计**: 使用面板容器分离各功能区域
  - 实时幸存者状态显示（HP、压力、怀疑度等进度条）
  - 事件日志系统
  - 动态选择按钮生成
  - 调试模式（显示NPC秘密）

### 🔧 配置系统
- **[`GameConstants`](src/Utilities/GameConstants.cs)**: 统一的游戏常量管理
  - 物资消耗参数
  - 状态恶化阈值
  - 随机事件概率
  - 初始值配置

## 游戏核心玩法

### Masquerade 机制
- **秘密系统**: NPC 拥有隐藏属性（感染、小偷等）
- **信任网络**: NPC之间动态的信任关系
- **线索与推理**: 玩家只能看到结果和线索，需要推理真相
- **投票驱逐**: 团队会议投票驱逐可疑成员

### 生存压力
- **物资管理**: 有限的物资需要合理分配
- **状态恶化**: 饥饿、压力会导致不良后果
- **随机事件**: 基于当前状态触发各种突发事件
- **时间压力**: 在30天内保持团队存活

## 项目架构

```
src/
├── Core/           # 核心数据结构
├── Engine/         # 游戏引擎（模拟、叙事）
├── Manager/        # 游戏管理器
├── UI/             # 用户界面
└── Utilities/      # 工具类（常量配置）

scenes/
└── Main.tscn       # 主场景布局

```

## 最新更新内容

### ✅ 按照TODO.md完成的功能
1. **⏰ 时间机制**: 添加了计时器系统，支持自动推进天数
2. **🎲 随机事件系统**: 实现了基于游戏状态的动态随机事件
3. **🎨 UI布局优化**: 重新设计了界面，使用面板容器让元素分布更合理
4. **📋 项目文档**: 完成了PROJECT_SUMMARY.md的详细记录

### 🎮 当前游戏状态
- ✅ 核心游戏循环完整实现
- ✅ 所有系统集成测试通过
- ✅ UI交互功能完整
- ✅ 编译无错误（仅有一些可空引用警告）

## 运行方式
1. 确保安装了 Godot 4.x 和 .NET SDK
2. 在项目目录运行 `dotnet build` 编译
3. 用 Godot 打开项目并运行

## 游戏控制
- **推进到下一天**: 手动推进游戏进程
- **召开会议**: 进行投票驱逐可疑成员  
- **自动模式**: 切换自动/手动时间推进
- **控制台命令**: 支持调试命令（help, status, secrets等）

## 下一步发展方向
- 集成真正的 LLM API（替换当前的模板系统）
- 添加更多事件类型和叙事分支
- 实现存档/读档功能
- 添加音效和视觉效果
- 扩展NPC AI行为系统